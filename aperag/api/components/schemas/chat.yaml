chat:
  type: object
  properties:
    id:
      type: string
    title:
      type: string
    bot_id:
      type: string
    peer_id:
      type: string
    peer_type:
      type: string
      enum: [system, feishu, weixin, weixin_official, web, dingtalk]
    status:
      type: string
      enum: [active, archived]
    created:
      type: string
      format: date-time
    updated:
      type: string
      format: date-time

reference:
  type: object
  properties:
    score:
      type: number
    text:
      type: string
    image_uri:
      type: string
    metadata:
      type: object
      additionalProperties: true

chatMessage:
  type: object
  properties:
    id:
      type: string
    part_id:
      type: string
    type:
      type: string
      enum: [welcome, message, start, stop, error, tool_call_result, thinking, references]
    timestamp:
      type: number
    role:
      type: string
      enum: [human, ai]
    data:
      type: string
    references:
      type: array
      items:
        $ref: '#/reference'
    urls:
      type: array
      items:
        type: string
    feedback:
      $ref: './feedback.yaml#/feedback'

chatDetails:
  type: object
  properties:
    id:
      type: string
    title:
      type: string
    bot_id:
      type: string
    peer_id:
      type: string
    peer_type:
      type: string
      enum: [system, feishu, weixin, weixin_official, web, dingtalk]
    history:
      type: array
      description: Array of conversation turns, where each turn is an array of message parts
      items:
        type: array
        description: A conversation turn containing multiple message parts (thinking, content, references, etc.)
        items:
          $ref: '#/chatMessage'
    status:
      type: string
      enum: [active, archived]
    created:
      type: string
      format: date-time
    updated:
      type: string
      format: date-time

chatList:
  type: object
  description: A list of chats with pagination
  allOf:
    - type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/chat'
    - $ref: './common.yaml#/paginatedResponse'

chatCreate:
  type: object
  properties:
    title:
      type: string

chatUpdate:
  type: object
  properties:
    title:
      type: string

message:
  type: object
  properties:
    id:
      type: string
    chat_id:
      type: string
    role:
      type: string
      enum: [user, assistant]
    content:
      type: string
    created:
      type: string
      format: date-time

messageList:
  type: object
  description: A list of messages
  properties:
    items:
      type: array
      items:
        $ref: '#/message'
    pageResult:
      $ref: './common.yaml#/pageResult'

messageCreate:
  type: object
  properties:
    content:
      type: string
    role:
      type: string
      enum: [user, assistant]

titleGenerateRequest:
  type: object
  properties:
    max_length:
      type: integer
      description: Maximum length of the generated title
      default: 20
      minimum: 6
      maximum: 50
    language:
      type: string
      description: Language for the title generation (IETF BCP 47 tag)
      default: "zh-CN"
      enum: ["zh-CN", "en-US", "ja-JP", "ko-KR"]
    turns:
      type: integer
      description: Number of most recent conversation turns to consider
      default: 1
      minimum: 1

titleGenerateResponse:
  type: object
  properties:
    title:
      type: string
      description: Generated title string
  required:
    - title
